<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Card Tracker - Tap Prototype</title>
<style>
  :root{
    --bg:#0f1220; --panel:#151936; --panel-b:#2b2f45; --text:#eef1ff;
    --pill:#0f162f; --pill-b:#2b2f45;
    --owned:#16a34a; --need:#e11d48; --dup:#7c3aed;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
  header{padding:12px 16px;font-weight:700}
  .deck{max-width:480px;margin:0 auto 24px;background:var(--panel);border:1px solid var(--panel-b);border-radius:16px;padding:12px}
  .deck h2{margin:0 0 10px 0}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .card{
    position:relative;background:#0f1430;border:1px solid var(--panel-b);
    border-radius:16px;min-height:120px;padding:10px;display:flex;flex-direction:column;justify-content:space-between;
  }
  .name{font-weight:600;font-size:14px;opacity:.95}

  /* NEW: TOP-CENTER star badge */
  .star-badge{
    position:absolute;
    top:-12px;
    left:50%;
    transform:translateX(-50%);
    background:#e67e22;
    color:#fff;
    font-weight:800;
    font-size:12px;
    padding:6px 10px;
    border-radius:12px;
    box-shadow:0 2px 6px rgba(0,0,0,.3);
  }

  /* NEW: TOP-RIGHT duplicate +N badge */
  .dup-badge{
    position:absolute;
    top:8px;
    right:8px;
    background:#7c3aed;
    color:#fff;
    font-weight:800;
    font-size:12px;
    padding:4px 8px;
    border-radius:10px;
    display:none;
    line-height:1;
  }
  .card.duplicate .dup-badge{ display:block; }

  /* NEW: gold lock top-left */
  .gold-lock{
    position:absolute;
    top:8px;
    left:8px;
    font-size:14px;
    display:none;
  }
  .card.gold .gold-lock{ display:block; }

  /* NEW: centered state pill at bottom (no overlap) */
  .state-pill{
    margin-top:8px;
    font-size:12px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid var(--pill-b);
    background:var(--pill);
    opacity:.9;
    text-align:center;
    align-self:center; /* key: center within card's flex column */
  }

  /* Modal */
  dialog{border:none;border-radius:18px;padding:0;width:min(520px,96vw)}
  dialog::backdrop{background:rgba(0,0,0,.5)}
  .sheet{background:#0f1430;color:var(--text);border:1px solid var(--panel-b);border-radius:18px;overflow:hidden}
  .sheet header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:#141936;border-bottom:1px solid var(--panel-b)}
  .sheet main{padding:14px}
  .close{background:transparent;border:1px solid var(--panel-b);color:var(--text);border-radius:10px;padding:6px 10px}
  .status{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
  .status button{flex:1;min-width:100px;padding:10px;border-radius:12px;border:1px solid var(--panel-b);background:#1f2340;color:var(--text)}
  .status .on{outline:2px solid #4b6bff}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  select, input, button{font:inherit}
  .big{width:100%;padding:12px;border-radius:12px;border:1px solid var(--panel-b);background:#3d5afe;color:#fff}
  .sub{padding:10px 12px;border-radius:12px;border:1px solid var(--panel-b);background:#1f2340;color:var(--text)}
</style>
</head>
<body>
  <header>Tap a card â†’ Full-screen sheet â†’ Pick Needed / Owned / Duplicate</header>
  <section class="deck">
    <h2 contenteditable="true">Beach</h2>
    <div class="grid" id="grid"></div>
  </section>

  <dialog id="sheet">
    <form method="dialog" class="sheet">
      <header>
        <div>
          <div id="deckTitle" style="font-size:12px;opacity:.8">Deck</div>
          <div id="cardTitle" style="font-size:18px;font-weight:800">Card</div>
        </div>
        <button class="close" value="cancel" aria-label="Close">âœ•</button>
      </header>
      <main>
        <div class="row" style="justify-content:space-between;margin-bottom:8px">
          <div>Stars: <span id="stars">â˜†â˜†â˜†â˜†â˜†</span></div>
          <div><label><input type="checkbox" id="goldChk"> Gold (unsharable)</label></div>
        </div>

        <div class="status">
          <button type="button" id="btnNeeded">Needed</button>
          <button type="button" id="btnOwned">Owned</button>
          <button type="button" id="btnDup">Duplicate</button>
          <button type="button" id="btnNone">â€”</button>
        </div>

        <div class="row" id="dupRow" style="display:none">
          <label>How many extras?</label>
          <select id="dupCount">
            <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
            <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
          </select>
          <button type="button" class="sub" id="minus">âˆ’</button>
          <button type="button" class="sub" id="plus">+</button>
        </div>

        <div class="row" style="margin-top:12px;justify-content:flex-end">
          <button class="sub" id="saveNext" type="button">Save & Next â–¶</button>
          <button class="big" id="save" type="submit">Save</button>
        </div>
      </main>
    </form>
  </dialog>

<script>
  // ------- Simple local data ---------
  const CARDS = [
    {name:"Beachball", stars:3, status:"none", dup:0, gold:false},
    {name:"Pier", stars:5, status:"none", dup:0, gold:false},
    {name:"Beverage", stars:3, status:"none", dup:0, gold:false},
    {name:"Life Ring", stars:5, status:"none", dup:0, gold:false},
    {name:"Beach Bar", stars:7, status:"none", dup:0, gold:false},
    {name:"Conch Shell", stars:8, status:"none", dup:0, gold:false},
    {name:"Parasol", stars:7, status:"none", dup:0, gold:false},
    {name:"Sand Castle", stars:5, status:"none", dup:0, gold:false},
    {name:"Flamingo", stars:6, status:"none", dup:0, gold:false},
  ];

  function save(){ localStorage.setItem("demo.cards", JSON.stringify(CARDS)); }
  (function load(){
    const raw = localStorage.getItem("demo.cards");
    if(raw){ try{ const v=JSON.parse(raw); if(Array.isArray(v)&&v.length===9){ v.forEach((c,i)=>CARDS[i]={...CARDS[i],...c}); } }catch{} }
  })();

  // ------- Render grid ---------
  const grid = document.getElementById('grid');
  function cls(s){ return s==='none'?'':s; }
  function badgeText(c){ return c.status==='duplicate' && c.dup>0 ? '+'+c.dup : ''; }
  function stateLabel(s){ return s==='owned'?'OWNED':s==='needed'?'NEEDED':s==='duplicate'?'DUPLICATE':'â€”'; }

  // Keep starStr() for the DIALOG only (five-star row inside the modal)
  function starStr(n){
    const v=Math.max(0,Math.min(10, +n||0));
    return 'â˜…'.repeat(Math.min(5,Math.ceil(v/2))) + 'â˜†'.repeat(5-Math.min(5,Math.ceil(v/2)));
  }

  function render(){
    grid.innerHTML='';
    CARDS.forEach((c,idx)=>{
      const el=document.createElement('div');
      el.className='card '+cls(c.status)+(c.gold?' gold':'');
      el.innerHTML=`
        <div class="star-badge">â˜…${c.stars}</div>
        <div class="dup-badge">${badgeText(c)}</div>
        <div class="gold-lock">ðŸ”’</div>
        <div class="name">${c.name}</div>
        <div class="state-pill">${stateLabel(c.status)}</div>
      `;
      el.addEventListener('click', ()=>openSheet(idx));
      grid.appendChild(el);
    });
  }

  // ------- Sheet logic ---------
  const dlg = document.getElementById('sheet');
  let cur = 0;

  const deckTitle = document.getElementById('deckTitle');
  const cardTitle = document.getElementById('cardTitle');
  const starsEl = document.getElementById('stars');
  const goldChk = document.getElementById('goldChk');
  const dupRow = document.getElementById('dupRow');
  const dupCount = document.getElementById('dupCount');
  const btnNeeded = document.getElementById('btnNeeded');
  const btnOwned = document.getElementById('btnOwned');
  const btnDup = document.getElementById('btnDup');
  const btnNone = document.getElementById('btnNone');
  const saveBtn = document.getElementById('save');
  const saveNext = document.getElementById('saveNext');
  const minus = document.getElementById('minus');
  const plus = document.getElementById('plus');

  function syncButtons(c){
    [btnNeeded,btnOwned,btnDup,btnNone].forEach(b=>b.classList.remove('on'));
    if(c.status==='needed') btnNeeded.classList.add('on');
    else if(c.status==='owned') btnOwned.classList.add('on');
    else if(c.status==='duplicate') btnDup.classList.add('on');
    else btnNone.classList.add('on');

    dupRow.style.display = c.status==='duplicate' && !c.gold ? 'flex' : 'none';
    dupCount.value = String(Math.max(1,c.dup||1));
    goldChk.checked = !!c.gold;
  }

  function openSheet(i){
    cur = i;
    const c = CARDS[i];
    deckTitle.textContent = "Beach";
    cardTitle.textContent = c.name;
    starsEl.textContent = starStr(c.stars); // five-star row in the dialog
    syncButtons(c);
    dlg.showModal();
  }

  btnNeeded.onclick = ()=>{ CARDS[cur].status='needed'; save(); syncButtons(CARDS[cur]); };
  btnOwned.onclick  = ()=>{ CARDS[cur].status='owned'; CARDS[cur].dup=0; save(); syncButtons(CARDS[cur]); };
  btnDup.onclick    = ()=>{ CARDS[cur].status='duplicate'; if(!CARDS[cur].dup) CARDS[cur].dup=1; save(); syncButtons(CARDS[cur]); };
  btnNone.onclick   = ()=>{ CARDS[cur].status='none'; CARDS[cur].dup=0; save(); syncButtons(CARDS[cur]); };

  goldChk.onchange = ()=>{
    CARDS[cur].gold = goldChk.checked;
    if(CARDS[cur].gold){ CARDS[cur].status='owned'; CARDS[cur].dup=0; }
    save(); syncButtons(CARDS[cur]);
  };

  dupCount.onchange = ()=>{ CARDS[cur].dup = Math.max(1, +dupCount.value||1); save(); };
  minus.onclick = ()=>{ const v=Math.max(1,(+dupCount.value||1)-1); dupCount.value=v; CARDS[cur].dup=v; save(); };
  plus.onclick = ()=>{ const v=Math.min(10,(+dupCount.value||1)+1); dupCount.value=v; CARDS[cur].dup=v; save(); };

  saveBtn.addEventListener('click', (e)=>{
    e.preventDefault();
    dlg.close();
    render(); save();
  });

  saveNext.onclick = ()=>{
    dlg.close();
    render(); save();
    const next = (cur+1)%CARDS.length;
    setTimeout(()=>openSheet(next), 50);
  };

  dlg.addEventListener('close', render);

  // init
  render();
</script>
</body>
</html>
